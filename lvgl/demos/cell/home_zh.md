**仪表板系统设计文档**

### 概述
本文件描述了汽车仪表板系统的设计，重点介绍了主要组件：指示灯、转速（RPM）、车速、档位、油量和水温。每个模块都有其生命周期函数，包括初始化、创建、更新（刷新）和白天黑夜模式切换。这种模块化设计确保了关注点分离、可重用性和易维护性。

### 仪表板架构图
下图为仪表板各个模块的简化图，展示了它们之间的关系及核心功能：

```
+---------------------+    +--------------------+
|     Indicators      |    |       RPM View     |
|                     |    |                    |
|  - Init             |    |  - Init            |
|  - Create           |    |  - Create          |
|  - Refresh          |    |  - Refresh         |
|  - Toggle Day/Night |    |  - Toggle Day/Night|
+---------------------+    +--------------------+
         |                            |
         v                            v
+---------------------+    +--------------------+
|      Speed View     |    |     Gear View      |
|                     |    |                    |
|  - Init             |    |  - Init            |
|  - Create           |    |  - Create          |
|  - Refresh          |    |  - Refresh         |
|  - Toggle Day/Night |    |  - Toggle Day/Night|
+---------------------+    +--------------------+
         |                            |
         v                            v
+---------------------+    +--------------------+
|     Oil Gauge      |    |   Water Temp Gauge  |
|                    |    |                    |
|  - Init             |    |  - Init            |
|  - Create           |    |  - Create          |
|  - Refresh          |    |  - Refresh         |
|  - Toggle Day/Night |    |  - Toggle Day/Night|
+---------------------+    +--------------------+
```
### 模块描述

1. **指示灯模块**
   - **用途**: 管理仪表板上的各种指示灯，如发动机检查、蓄电池、转向灯等。
   - **接口**:
     - `Init`: 初始化指示灯系统所需的所有资源。
     - `Create`: 在屏幕上设置每个指示灯的 UI 元素。
     - `Refresh`: 根据传感器数据更新每个指示灯的状态。
     - `ToggleDayNightMode`: 在白天黑夜 UI 模式之间切换。

2. **转速视图**
   - **用途**: 显示发动机的每分钟转速（RPM）。
   - **接口**:
     - `Init`: 初始化转速视图资源。
     - `Create`: 创建表示转速的 UI 元素。
     - `Refresh`: 更新屏幕上的转速值。
     - `ToggleDayNightMode`: 根据白天黑夜模式更改颜色和亮度。

3. **速度视图**
   - **用途**: 显示车辆速度。
   - **接口**:
     - `Init`: 初始化速度视图资源。
     - `Create`: 创建速度显示的 UI 元素。
     - `Refresh`: 更新屏幕上的速度。
     - `ToggleDayNightMode`: 调整速度显示的白天黑夜模式。

4. **档位视图**
   - **用途**: 显示当前档位。
   - **接口**:
     - `Init`: 初始化档位视图资源。
     - `Create`: 在 UI 上设置档位显示。
     - `Refresh`: 根据用户输入更新档位显示。
     - `ToggleDayNightMode`: 修改档位显示的白天黑夜模式。

5. **油量表视图**
   - **用途**: 监控并显示当前油量。
   - **接口**:
     - `Init`: 初始化油量表资源。
     - `Create`: 设置油量表的 UI。
     - `Refresh`: 更新油量显示。
     - `ToggleDayNightMode`: 调整油量表的白天黑夜模式。

6. **水温表视图**
   - **用途**: 显示当前发动机水温。
   - **接口**:
     - `Init`: 初始化水温表资源。
     - `Create`: 设置水温表的 UI。
     - `Refresh`: 更新水温读数。
     - `ToggleDayNightMode`: 调整水温表的白天黑夜显示。

```
+---------------------+        +---------------------+            +---------------------+
|   System Startup    |        |   CAN Data Received  |           | Button/IO Processing|
+---------+-----------+        +---------+-----------+            +---------------------+
          |                          |                                        |
          v                          v                                        |
+---------v-----------+        +-----v---------------+                        |
| Module Initialization |      | Data Update Trigger | <----------------------+
| (Call each module Init)|     | (Call each module Refresh)|
+---------+-----------+        +---------+-----------+
          |                          |
          v                          |
+---------v-----------+              |
|  Module Creation    |              |
| (Call each module Create)          |
+---------+-----------+              |
          |                          |
          v                          |
+---------v-----------+              |
| Day-Night Mode Phase| <------------+
| (Call each module Toggle |
| DayNightMode)       |
+---------------------+


```

### 数据流与交互
- **CAN 数据处理**: 系统从 CAN 总线接收实时数据。每个模块订阅相关数据以更新 UI。
- **中央更新触发器**: 每次处理新数据时，中央数据模型会触发相关模块的 `Refresh` 函数，以确保仪表板反映最新信息。
- **白天黑夜模式切换**: 当光传感器检测到环境光变化时或者手动切换白天黑夜模式，会调用 `ToggleDayNightMode` 接口，修改仪表板的颜色以获得最佳可见性。

### 模块化设计的优势
- **关注点分离**: 每个模块负责 UI 的一个部分，使得维护和扩展更加容易。
- **可扩展性**: 添加新功能（如新的表盘或指示灯）非常简单，因为它们遵循相同的生命周期函数。
- **易于测试**: 每个模块可以独立测试，简化了验证过程。

### 结论
该设计确保仪表板系统是模块化的、易于维护和扩展的。每个模块都有明确的职责，并通过支持初始化、UI 创建、实时刷新和白天黑夜调整的接口来实现其功能。